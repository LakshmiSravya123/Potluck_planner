<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Create New Potluck Event</title>
  <link rel="stylesheet" href="style.css?v=20251103221322" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js?v=20251103221322"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js?v=20251103221322"></script>
</head>
<body class="theme-default">
  <!-- Animated Decorations -->
  <div class="decorations" id="decorations"></div>
  
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">ğŸ‰</span>
          <span>Create Potluck</span>
        </div>
        <p class="tagline">Start planning your perfect gathering in seconds!</p>
      </div>
    </header>

    <!-- Create Event Card -->
    <div class="card">
      <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 700; color: #1f2937;">
        âœ¨ Event Details
      </h2>
      
      <div class="input-group">
        <label for="new-event-name">Event Name *</label>
        <input type="text" id="new-event-name" placeholder="e.g., Summer BBQ Party" class="input" required />
      </div>

      <!-- Two column layout for date/time -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="input-group">
          <label for="event-date">Date *</label>
          <input type="date" id="event-date" class="input" required />
          <small style="color: var(--gray-600); font-size: 0.75rem; margin-top: 0.25rem;">
            â„¹ï¸ Events are automatically deleted 2 days after the event date
          </small>
        </div>

        <div class="input-group">
          <label for="event-time">Time</label>
          <input type="time" id="event-time" class="input" />
        </div>
      </div>

      <div class="input-group">
        <label for="event-location">Location</label>
        <input type="text" id="event-location" placeholder="e.g., 123 Main St or Backyard" class="input" />
      </div>

      <!-- Two column layout for host info -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="input-group">
          <label for="host-name">Host Name *</label>
          <input type="text" id="host-name" placeholder="Your name" class="input" required />
        </div>

        <div class="input-group">
          <label for="host-email">Email (optional)</label>
          <input type="email" id="host-email" placeholder="your@email.com" class="input" />
        </div>
      </div>

      <div class="input-group">
        <label for="new-theme">Choose Theme *</label>
        <select id="new-theme" class="input" required>
      <option value="birthday">ğŸ‚ Birthday</option>
      <option value="christmas">ğŸ„ Christmas</option>
      <option value="halloween">ğŸƒ Halloween</option>
      <option value="valentines">â¤ï¸ Valentines</option>
      <option value="diwali">ğŸª” Diwali</option>
      <option value="thanksgiving">ğŸ¦ƒ Thanksgiving</option>
      <option value="newyear">ğŸ† New Year</option>
      <option value="easter">ğŸ° Easter</option>
      <option value="bbq">ğŸ” BBQ</option>
      <option value="beach">ğŸ–ï¸ Beach</option>
      <option value="wedding">ğŸ’’ Wedding</option>
      <option value="babyshower">ğŸ‘¶ Baby Shower</option>
      <option value="graduation">ğŸ“ Graduation</option>
      <option value="superbowl">ğŸˆ Super Bowl</option>
      <option value="cinco">ğŸŒ® Cinco</option>
      <option value="pride">ğŸŒˆ Pride</option>
      <option value="ramadan">ğŸŒ™ Ramadan</option>
      <option value="hanukkah">ğŸ• Hanukkah</option>
      <option value="autumn">ğŸ‚ Autumn</option>
      <option value="spring">ğŸŒ¸ Spring</option>
      <option value="summer">â˜€ï¸ Summer</option>
      <option value="winter">â„ï¸ Winter</option>
      <option value="picnic">ğŸ§º Picnic</option>
      <option value="gamenight">ğŸ® Game Night</option>
      <option value="movienight">ğŸ¬ Movie Night</option>
      <option value="brunch">ğŸ¥ Brunch</option>
      <option value="tailgate">ğŸŸï¸ Tailgate</option>
      <option value="fiesta">ğŸŠ Fiesta</option>
      <option value="luau">ğŸŒº Luau</option>
      <option value="oktoberfest">ğŸº Oktoberfest</option>
      <option value="stpatricks">â˜˜ï¸ St. Patrick's</option>
      <option value="mardis">ğŸ­ Mardi Gras</option>
        </select>
      </div>

      <button id="createEventBtn" onclick="createPotluckEvent()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
        <svg id="createIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"></path>
        </svg>
        <span id="createBtnText">Create Event & Get Link</span>
        <span id="createLoader" style="display: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
            <circle cx="12" cy="12" r="10"></circle>
          </svg>
          Creating...
        </span>
      </button>
      
      <style>
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      </style>
    </div>

    <!-- Result Card -->
    <div id="result-card" class="card" style="display: none; margin-top: 1.5rem;">
      <h3 style="font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 1rem;">
        ğŸ‰ Event Created Successfully!
      </h3>
      <div id="share-link" style="background: #f3f4f6; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1rem;">
      </div>
      <button onclick="location.href='index.html'" class="btn" style="width: 100%; background: white; color: #6366f1; border: 2px solid #6366f1;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"></path>
        </svg>
        Back to Home
      </button>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>Made with â¤ï¸ for potluck lovers everywhere</p>
      
  </div>

  <script>
    // Wait for Firebase to load
    let db;
    
    window.addEventListener('load', function() {
      // Initialize Firebase for create page
      const firebaseConfig = {
        apiKey: "AIzaSyCzvH64kpIcpgUrjxVsJBhF9SxME7pVCyQ",
        authDomain: "potluck-planner-15a68.firebaseapp.com",
        databaseURL: "https://potluck-planner-15a68-default-rtdb.firebaseio.com",
        projectId: "potluck-planner-15a68",
        storageBucket: "potluck-planner-15a68.firebasestorage.app",
        messagingSenderId: "209595251975",
        appId: "1:209595251975:web:961acb493b364e9fedd9a2",
        measurementId: "G-VQKX9HP4SM"
      };
      
      if (typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        console.log('âœ… Firebase initialized successfully');
      } else {
        console.error('âŒ Firebase SDK not loaded');
      }
    });
    
    // Theme preview - change background when theme is selected
    document.getElementById('new-theme').addEventListener('change', function(e) {
      const theme = e.target.value;
      document.body.className = 'theme-' + theme;
      createDefaultDecorations(theme);
    });
    
    function createPotluckEvent() {
      if (!db) {
        alert('Firebase is still loading, please wait a moment and try again.');
        return;
      }
      
      // Show loading state
      const btn = document.getElementById('createEventBtn');
      const btnText = document.getElementById('createBtnText');
      const btnIcon = document.getElementById('createIcon');
      const loader = document.getElementById('createLoader');
      
      btn.disabled = true;
      btnText.style.display = 'none';
      btnIcon.style.display = 'none';
      loader.style.display = 'inline-flex';
      loader.style.alignItems = 'center';
      loader.style.gap = '0.5rem';
      
      // Get and validate inputs
      const name = document.getElementById('new-event-name').value.trim();
      const eventDate = document.getElementById('event-date').value;
      const eventTime = document.getElementById('event-time').value;
      const eventLocation = document.getElementById('event-location').value.trim();
      const hostName = document.getElementById('host-name').value.trim();
      const hostEmail = document.getElementById('host-email').value.trim();
      const theme = document.getElementById('new-theme').value;
      
      // Helper to reset button state
      function resetButton() {
        btn.disabled = false;
        btnText.style.display = 'inline';
        btnIcon.style.display = 'inline';
        loader.style.display = 'none';
      }
      
      // Validation
      if (!name || name.length < 3) {
        alert('âŒ Please enter an event name (at least 3 characters)');
        resetButton();
        return;
      }
      if (!eventDate) {
        alert('âŒ Please select an event date');
        resetButton();
        return;
      }
      if (!hostName || hostName.length < 2) {
        alert('âŒ Please enter your name as the host');
        resetButton();
        return;
      }
      if (hostEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(hostEmail)) {
        alert('âŒ Please enter a valid email address');
        resetButton();
        return;
      }
      
      const id = Date.now().toString(36).toUpperCase();
      const url = `${window.location.origin}/Potluck_planner/index.html?code=${id}`;
      
      // Create comprehensive event object
      const eventData = {
        createdAt: Date.now(),
        name: name,
        theme: theme,
        date: eventDate,
        time: eventTime || null,
        location: eventLocation || null,
        host: {
          name: hostName,
          email: hostEmail || null
        },
        settings: {
          allowDuplicates: false,
          requireApproval: false,
          maxDishes: 100
        },
        stats: {
          totalDishes: 0,
          totalContributors: 0
        }
      };
      
      db.ref(`events/${id.toLowerCase()}`).set(eventData).then(() => {
        // Update button to success state
        loader.innerHTML = 'âœ… Created!';
        setTimeout(() => {
          loader.style.display = 'none';
          btnText.textContent = 'âœ… Event Created';
          btnText.style.display = 'inline';
        }, 500);
        
        // Show result card
        document.getElementById('result-card').style.display = 'block';
        document.getElementById('share-link').innerHTML = `
          <div style="margin-bottom: 1rem;">
            <p style="font-weight: 600; color: #374151; margin-bottom: 0.5rem;">Event Code:</p>
            <p style="font-size: 2rem; font-weight: 800; color: #6366f1; letter-spacing: 0.1em;">${id}</p>
          </div>
          <div style="margin-bottom: 1rem;">
            <p style="font-weight: 600; color: #374151; margin-bottom: 0.5rem;">Share Link:</p>
            <input type="text" value="${url}" readonly style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 0.875rem; background: white;" onclick="this.select()">
          </div>
          <button onclick="navigator.clipboard.writeText('${url}'); alert('âœ… Link copied to clipboard!')" class="btn btn-primary" style="width: 100%;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            Copy Link
          </button>
        `;
        
        // Scroll to result
        document.getElementById('result-card').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        console.log('âœ… Event created:', id);
      }).catch(err => {
        console.error('âŒ Error creating event:', err);
        alert('âŒ Error creating event: ' + err.message);
        resetButton();
      });
    }
    
    // Create default decorations
    function createDefaultDecorations(theme) {
      const container = document.getElementById('decorations');
      container.innerHTML = '';
      
      // Simple confetti for all themes
      for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
        container.appendChild(confetti);
      }
    }
    
    // Initialize with default decorations
    createDefaultDecorations('default');
  </script>
</body>
</html>