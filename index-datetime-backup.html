<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Potluck Party - Best Ever!</title>
    <meta name="description" content="Simple potluck planning with date/time magic, countdown, and calendar integration">
    
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.5s ease-out',
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-red': 'pulseRed 1s ease-in-out infinite'
                    }
                }
            }
        }
    </script>
    
    <!-- Flatpickr CDN for date/time -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        .gradient-bg { background: linear-gradient(135deg, #fed7aa 0%, #bbf7d0 100%); }
        .dark .gradient-bg { background: linear-gradient(135deg, #1e293b 0%, #1e3a2e 100%); }
        .card-hover { transition: all 0.2s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes float {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes pulseRed {
            0%,100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .countdown-urgent { 
            animation: pulseRed 1s ease-in-out infinite;
            color: #dc2626;
            font-weight: 900;
        }
        
        .dish-pill { 
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .dish-meat { background: #fecaca; color: #991b1b; }
        .dish-vegan { background: #bbf7d0; color: #166534; }
        .dish-dessert { background: #fef3c7; color: #92400e; }
        .dish-drink { background: #ddd6fe; color: #5b21b6; }
        .dish-other { background: #e5e7eb; color: #374151; }
        
        .dark .dish-meat { background: #7f1d1d; color: #fecaca; }
        .dark .dish-vegan { background: #14532d; color: #bbf7d0; }
        .dark .dish-dessert { background: #78350f; color: #fef3c7; }
        .dark .dish-drink { background: #4c1d95; color: #ddd6fe; }
        .dark .dish-other { background: #1f2937; color: #e5e7eb; }
    </style>
</head>
<body class="gradient-bg min-h-screen font-sans transition-colors">
    
    <!-- DATE: Countdown + reminders = BEST! -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- Party Header -->
        <div class="text-center mb-8">
            <h1 id="partyTitle" contenteditable="true" 
                class="text-4xl md:text-5xl font-black text-gray-800 dark:text-white mb-4 outline-none hover:bg-white/30 dark:hover:bg-white/10 rounded-lg px-4 py-2 transition-colors cursor-text">
                ğŸ‰ Thanksgiving Potluck
            </h1>
            
            <!-- Date/Time Banner -->
            <div id="dateTimeBanner" class="bg-white/80 dark:bg-gray-800/80 backdrop-blur rounded-2xl shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="text-center md:text-left">
                        <div id="eventDateTime" class="text-2xl font-bold text-gray-800 dark:text-white mb-2">
                            ğŸ“… Nov 15, 2025 @ 6:00 PM
                        </div>
                        <div id="eventLocation" class="text-lg text-gray-600 dark:text-gray-300 mb-2">
                            ğŸŒ NYC Park
                        </div>
                        <div id="countdown" class="text-xl font-semibold text-gray-700 dark:text-gray-200">
                            â° 12 days left!
                        </div>
                    </div>
                    <div class="flex flex-col gap-2">
                        <button onclick="editDateTime()" 
                            class="bg-blue-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                            ğŸ“ Edit Date/Time
                        </button>
                        <button onclick="addToCalendar()" 
                            class="bg-green-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-600 transition-colors">
                            ğŸ“… Add to Calendar
                        </button>
                        <button onclick="setReminder()" 
                            class="bg-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors">
                            ğŸ”” Remind Me
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Guest Button -->
        <div class="flex justify-center mb-6">
            <button onclick="showAddGuest()" 
                class="bg-white dark:bg-gray-800 text-gray-800 dark:text-white px-8 py-4 rounded-full font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition-all flex items-center gap-3 text-lg">
                <span class="text-2xl">â•</span> Add Me
            </button>
        </div>
        
        <!-- Guest Count -->
        <div class="text-center mb-8">
            <div class="inline-block bg-white/80 dark:bg-gray-800/80 backdrop-blur px-8 py-4 rounded-full shadow-lg">
                <span class="text-3xl font-bold text-gray-800 dark:text-white" id="guestCount">0</span>
                <span class="text-gray-600 dark:text-gray-300 ml-3 text-lg">GUESTS</span>
            </div>
        </div>
        
        <!-- Guests List -->
        <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur rounded-2xl shadow-xl overflow-hidden mb-8">
            <div id="guestsList" class="divide-y divide-gray-100 dark:divide-gray-700">
                <!-- Guests added here -->
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-16 text-gray-400 dark:text-gray-500">
                <div class="text-8xl mb-4">ğŸ½ï¸</div>
                <p class="text-2xl font-medium mb-2">No guests yet</p>
                <p class="text-lg">Be the first to join the party! ğŸ‰</p>
            </div>
        </div>
        
        <!-- Footer Actions -->
        <div class="flex justify-center gap-4 flex-wrap">
            <button onclick="copyLink()" 
                class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg shadow hover:shadow-md transition-all flex items-center gap-2 font-medium">
                <span>ğŸ“‹</span> Copy Link
            </button>
            <button onclick="showQR()" 
                class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg shadow hover:shadow-md transition-all flex items-center gap-2 font-medium">
                <span>ğŸ“¸</span> QR
            </button>
            <button onclick="exportCSV()" 
                class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg shadow hover:shadow-md transition-all flex items-center gap-2 font-medium">
                <span>ğŸ“„</span> Export CSV
            </button>
            <button onclick="toggleDarkMode()" 
                class="bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg shadow hover:shadow-md transition-all flex items-center gap-2 font-medium">
                <span id="darkModeIcon">ğŸŒ™</span> Dark
            </button>
        </div>
    </main>
    
    <!-- Date/Time Modal -->
    <div id="dateTimeModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl animate-bounce-in">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Set Event Date & Time</h3>
            <form onsubmit="saveDateTime(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date & Time</label>
                    <input type="text" id="datetimePicker" required 
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="Select date and time...">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Location</label>
                    <input type="text" id="eventLocationInput" 
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                        placeholder="Where's the party?">
                </div>
                <div class="flex gap-3">
                    <button type="submit" 
                        class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-bold hover:bg-blue-600 transition-colors">
                        Save
                    </button>
                    <button type="button" onclick="hideDateTimeModal()" 
                        class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 rounded-lg font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Guest Modal -->
    <div id="addGuestModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl animate-bounce-in">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Join the Party!</h3>
            <form onsubmit="addGuest(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Your Name</label>
                    <input type="text" id="guestName" required 
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                        placeholder="Enter your name...">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">What are you bringing?</label>
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        <button type="button" onclick="selectDish('Pizza', 'ğŸ•')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ•</button>
                        <button type="button" onclick="selectDish('Pie', 'ğŸ¥§')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ¥§</button>
                        <button type="button" onclick="selectDish('Beer', 'ğŸº')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸº</button>
                        <button type="button" onclick="selectDish('Salad', 'ğŸ¥—')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ¥—</button>
                        <button type="button" onclick="selectDish('Pasta', 'ğŸ')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ</button>
                        <button type="button" onclick="selectDish('Wine', 'ğŸ·')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ·</button>
                        <button type="button" onclick="selectDish('Bread', 'ğŸ')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ</button>
                        <button type="button" onclick="selectDish('Custom', 'ğŸ½ï¸')" class="dish-emoji-btn p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-2xl">ğŸ½ï¸</button>
                    </div>
                    <input type="text" id="guestDish" required 
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white"
                        placeholder="What are you bringing?">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">How many people? (Optional)</label>
                    <select id="guestCount" 
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:bg-gray-700 dark:text-white">
                        <option value="1">Just me (1)</option>
                        <option value="2">Me +1 (2)</option>
                        <option value="3">Me +2 (3)</option>
                        <option value="4">Me +3 (4)</option>
                        <option value="5+">Party squad (5+)</option>
                    </select>
                </div>
                <div class="flex gap-3">
                    <button type="submit" 
                        class="flex-1 bg-emerald-500 text-white py-3 rounded-lg font-bold hover:bg-emerald-600 transition-colors">
                        Join Party!
                    </button>
                    <button type="button" onclick="hideAddGuest()" 
                        class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 rounded-lg font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- QR Modal -->
    <div id="qrModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Share Party</h3>
            <div class="bg-gray-100 dark:bg-gray-700 p-6 rounded-lg text-center mb-4">
                <div class="text-6xl mb-3">ğŸ“±</div>
                <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">Scan to join the party!</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 break-all font-mono" id="shareUrl"></p>
            </div>
            <button onclick="hideQR()" 
                class="w-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 rounded-lg font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                Close
            </button>
        </div>
    </div>
    
    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-emerald-500 text-white px-6 py-3 rounded-lg shadow-lg hidden transition-all z-50">
        <span id="toastMsg"></span>
    </div>
    
    <!-- Confetti Canvas -->
    <canvas id="confetti" class="fixed inset-0 pointer-events-none z-50"></canvas>
    
    <script>
        // Data: URL hash Base64 + {title, date, time, guests[]}
        let data = {
            title: "ğŸ‰ Thanksgiving Potluck",
            date: "2025-11-15",
            time: "18:00",
            location: "ğŸŒ NYC Park",
            guests: []
        };
        let saveTimer = null;
        let datetimePicker = null;
        
        // Random emoji picker
        const emojis = ['ğŸ˜Š', 'ğŸ•', 'ğŸ‰', 'ğŸ‘©â€ğŸ³', 'ğŸ§‘â€ğŸ³', 'ğŸ˜„', 'ğŸ¥³', 'ğŸŠ', 'ğŸ»', 'ğŸ¥‚', 'ğŸ°', 'ğŸ‚', 'ğŸ”', 'ğŸŒ®', 'ğŸœ', 'ğŸ¸', 'ğŸ¨', 'ğŸƒ', 'ğŸŒŸ', 'âœ¨'];
        
        // Load from URL hash (30ms loads)
        function loadData() {
            const hash = location.hash.slice(1);
            if (hash.startsWith('data=')) {
                try {
                    const decoded = JSON.parse(atob(hash.slice(5)));
                    data = { ...data, ...decoded };
                } catch (e) {
                    console.error('Invalid data in hash');
                }
            }
            
            render();
            initDateTimePicker();
            updateCountdown();
            
            // Show date/time modal on first visit if no date set
            if (!data.date) {
                setTimeout(() => editDateTime(), 500);
            }
        }
        
        // Save: Keystroke debounce 100ms
        function save() {
            if (saveTimer) return;
            saveTimer = setTimeout(() => {
                location.hash = 'data=' + btoa(JSON.stringify(data));
                saveTimer = null;
            }, 100);
        }
        
        // Initialize Flatpickr
        function initDateTimePicker() {
            if (datetimePicker) datetimePicker.destroy();
            
            const datetimeInput = document.getElementById('datetimePicker');
            if (datetimeInput) {
                datetimePicker = flatpickr(datetimeInput, {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    minDate: "today",
                    defaultDate: data.date && data.time ? `${data.date} ${data.time}` : null,
                    onChange: function(selectedDates) {
                        if (selectedDates.length > 0) {
                            const date = selectedDates[0];
                            data.date = date.toISOString().split('T')[0];
                            data.time = date.toTimeString().slice(0, 5);
                        }
                    }
                });
            }
        }
        
        // Update countdown every minute
        function updateCountdown() {
            if (!data.date || !data.time) return;
            
            const eventDate = new Date(`${data.date}T${data.time}`);
            const now = new Date();
            const diff = eventDate - now;
            
            const countdownEl = document.getElementById('countdown');
            
            if (diff <= 0) {
                countdownEl.innerHTML = "ğŸ‰ PARTY TIME! ğŸ‰";
                countdownEl.className = "text-xl font-bold text-green-600 dark:text-green-400";
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            let countdownText = "â° ";
            if (days > 0) countdownText += `${days} day${days !== 1 ? 's' : ''} left!`;
            else if (hours > 0) countdownText += `${hours} hour${hours !== 1 ? 's' : ''} left!`;
            else countdownText += `${minutes} minute${minutes !== 1 ? 's' : ''} left!`;
            
            countdownEl.textContent = countdownText;
            
            // Red if <24hrs
            if (diff < 24 * 60 * 60 * 1000) {
                countdownEl.className = "text-xl font-bold countdown-urgent";
            } else {
                countdownEl.className = "text-xl font-semibold text-gray-700 dark:text-gray-200";
            }
        }
        
        // Date/Time modal functions
        function editDateTime() {
            document.getElementById('dateTimeModal').classList.remove('hidden');
            document.getElementById('eventLocationInput').value = data.location || '';
            
            // Set current date/time in picker
            if (data.date && data.time) {
                datetimePicker.setDate(`${data.date} ${data.time}`);
            }
        }
        
        function hideDateTimeModal() {
            document.getElementById('dateTimeModal').classList.add('hidden');
        }
        
        function saveDateTime(event) {
            event.preventDefault();
            
            const datetimeInput = document.getElementById('datetimePicker').value;
            if (datetimeInput) {
                const [date, time] = datetimeInput.split(' ');
                data.date = date;
                data.time = time;
            }
            
            data.location = document.getElementById('eventLocationInput').value || 'ğŸŒ Party Location';
            
            save();
            render();
            hideDateTimeModal();
            showToast('Date/time saved! ğŸ“…');
        }
        
        // Add to Calendar (download .ics file)
        function addToCalendar() {
            if (!data.date || !data.time) {
                showToast('Please set event date/time first! ğŸ“…');
                return;
            }
            
            const startDate = new Date(`${data.date}T${data.time}`);
            const endDate = new Date(startDate.getTime() + 3 * 60 * 60 * 1000); // +3 hours
            
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Potluck Party//Calendar//EN',
                'BEGIN:VEVENT',
                `DTSTART:${startDate.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '')}`,
                `DTEND:${endDate.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '')}`,
                `SUMMARY:${data.title}`,
                `DESCRIPTION:Join our potluck party! ${location.href}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');
            
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'potluck-party.ics';
            a.click();
            
            showToast('Calendar file downloaded! ğŸ“…');
        }
        
        // Set browser notification
        function setReminder() {
            if (!data.date || !data.time) {
                showToast('Please set event date/time first! ğŸ“…');
                return;
            }
            
            if (!("Notification" in window)) {
                showToast('Notifications not supported in your browser ğŸ˜”');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    const eventDate = new Date(`${data.date}T${data.time}`);
                    const reminderTime = eventDate.getTime() - (60 * 60 * 1000); // 1 hour before
                    
                    const now = Date.now();
                    if (reminderTime > now) {
                        setTimeout(() => {
                            new Notification("Potluck Reminder! ğŸ””", {
                                body: `${data.title} starts in 1 hour! Get ready!`,
                                icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‰</text></svg>"
                            });
                        }, reminderTime - now);
                        
                        showToast('Reminder set for 1 hour before event! ğŸ””');
                    } else {
                        showToast('Event is less than 1 hour away! ğŸƒ');
                    }
                } else {
                    showToast('Please enable notifications! ğŸ””');
                }
            });
        }
        
        // Guest functions
        function showAddGuest() {
            document.getElementById('addGuestModal').classList.remove('hidden');
            document.getElementById('guestName').focus();
        }
        
        function hideAddGuest() {
            document.getElementById('addGuestModal').classList.add('hidden');
            document.getElementById('guestName').value = '';
            document.getElementById('guestDish').value = '';
            document.getElementById('guestCount').value = '1';
        }
        
        function selectDish(dish, emoji) {
            document.getElementById('guestDish').value = dish;
        }
        
        function addGuest(event) {
            event.preventDefault();
            
            const name = document.getElementById('guestName').value.trim();
            const dish = document.getElementById('guestDish').value.trim();
            const count = document.getElementById('guestCount').value;
            
            if (!name || !dish) return;
            
            const guest = {
                name,
                dish,
                count,
                emoji: emojis[Math.floor(Math.random() * emojis.length)],
                id: Date.now()
            };
            
            data.guests.push(guest);
            save();
            render();
            hideAddGuest();
            
            // Confetti burst + toast
            confetti();
            showToast(`${name}'s in! ğŸ‰ Bringing ${dish}`);
        }
        
        function removeGuest(id) {
            data.guests = data.guests.filter(g => g.id !== id);
            save();
            render();
            showToast('Guest removed');
        }
        
        // Get dish category for color coding
        function getDishCategory(dish) {
            const lower = dish.toLowerCase();
            if (lower.includes('meat') || lower.includes('chicken') || lower.includes('beef') || lower.includes('pork')) return 'meat';
            if (lower.includes('salad') || lower.includes('vegetable') || lower.includes('vegan') || lower.includes('tofu')) return 'vegan';
            if (lower.includes('pie') || lower.includes('cake') || lower.includes('cookie') || lower.includes('dessert')) return 'dessert';
            if (lower.includes('beer') || lower.includes('wine') || lower.includes('drink') || lower.includes('juice')) return 'drink';
            return 'other';
        }
        
        // Render function
        function render() {
            // Update title
            document.getElementById('partyTitle').textContent = data.title;
            document.getElementById('guestCount').textContent = data.guests.length;
            
            // Update date/time display
            if (data.date && data.time) {
                const eventDate = new Date(`${data.date}T${data.time}`);
                const options = { 
                    weekday: 'short', 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                };
                document.getElementById('eventDateTime').textContent = `ğŸ“… ${eventDate.toLocaleDateString('en-US', options)}`;
            }
            
            document.getElementById('eventLocation').textContent = data.location || 'ğŸŒ Party Location';
            
            // Update page title
            const eventId = location.hash.slice(6, 14) || 'party';
            document.getElementById('pageTitle').textContent = `Potluck #${eventId} | ${data.guests.length} guests | ${data.date || 'TBD'}`;
            
            // Render guests
            const guestsList = document.getElementById('guestsList');
            const emptyState = document.getElementById('emptyState');
            
            if (data.guests.length === 0) {
                guestsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            guestsList.innerHTML = data.guests.map((guest, index) => {
                const category = getDishCategory(guest.dish);
                const countText = guest.count === '1' ? '' : ` +${guest.count.replace('+', '')}`;
                
                return `
                    <div class="flex items-center gap-4 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 card-hover animate-slide-in" style="animation-delay: ${index * 0.05}s">
                        <span class="text-3xl">${guest.emoji}</span>
                        <div class="flex-1">
                            <div class="font-semibold text-lg text-gray-800 dark:text-white">${guest.name}${countText}</div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="dish-pill dish-${category}">${guest.dish}</span>
                            <button onclick="removeGuest(${guest.id})" 
                                class="text-red-500 hover:text-red-700 font-medium text-sm">
                                âœ•
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Utility functions
        function copyLink() {
            navigator.clipboard.writeText(location.href);
            showToast('Link copied! ğŸ“‹');
        }
        
        function showQR() {
            document.getElementById('qrModal').classList.remove('hidden');
            document.getElementById('shareUrl').textContent = location.href;
        }
        
        function hideQR() {
            document.getElementById('qrModal').classList.add('hidden');
        }
        
        function exportCSV() {
            const csv = [
                ['Name', 'Dish', 'Guests'],
                ...data.guests.map(g => [g.name, g.dish, g.count])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'potluck-guests.csv';
            a.click();
            
            showToast('CSV exported! ğŸ“„');
        }
        
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('darkModeIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            showToast(isDark ? 'Dark mode on! ğŸŒ™' : 'Light mode on! â˜€ï¸');
        }
        
        // Toast notification
        function showToast(msg) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            
            toastMsg.textContent = msg;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }
        
        // Confetti animation
        function confetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = Array.from({ length: 60 }, () => ({
                x: Math.random() * canvas.width,
                y: -10,
                vx: (Math.random() - 0.5) * 6,
                vy: Math.random() * 4 + 2,
                color: ['#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'][Math.floor(Math.random() * 5)],
                size: Math.random() * 8 + 4
            }));
            
            const animate = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.15; // gravity
                    
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    
                    if (p.y > canvas.height) {
                        particles.splice(i, 1);
                    }
                });
                
                if (particles.length > 0) {
                    requestAnimationFrame(animate);
                }
            };
            
            animate();
        }
        
        // Handle title editing
        document.getElementById('partyTitle')?.addEventListener('input', function() {
            data.title = this.textContent;
            save();
        });
        
        // Handle hash changes (real-time sync)
        window.addEventListener('hashchange', loadData);
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            setInterval(updateCountdown, 60000); // Update countdown every minute
            
            // Live sync - check for changes every second
            setInterval(() => {
                const currentHash = location.hash;
                if (currentHash && currentHash !== 'data=' + btoa(JSON.stringify(data))) {
                    loadData();
                }
            }, 1000);
        });
    </script>
</body>
</html>
