<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Potluck Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="preload" href="style.css" as="style">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#e91e63" />
  <script>
    // Apply theme immediately to prevent flash
    (function() {
      const urlParams = new URLSearchParams(window.location.search);
      const theme = urlParams.get('theme');
      const eventId = urlParams.get('id') || 'default-event';
      
      // Theme detection from event ID
      const themeKeywords = {
        birthday: ['birthday', 'bday', 'cake'],
        christmas: ['christmas', 'xmas', 'holiday'],
        halloween: ['halloween', 'spooky', 'pumpkin'],
        valentines: ['valentine', 'love', 'heart'],
        diwali: ['diwali', 'festival', 'lights'],
        thanksgiving: ['thanksgiving', 'turkey', 'fall'],
        newyear: ['newyear', 'nye'],
        easter: ['easter', 'bunny', 'egg'],
        bbq: ['bbq', 'grill', 'summer'],
        beach: ['beach', 'pool', 'luau']
      };
      
      let detectedTheme = theme || 'neutral';
      if (!theme) {
        for (const [key, words] of Object.entries(themeKeywords)) {
          if (words.some(word => eventId.toLowerCase().includes(word))) {
            detectedTheme = key;
            break;
          }
        }
      }
      
      document.documentElement.className = `theme-${detectedTheme}`;
      document.body.className = `theme-${detectedTheme}`;
    })();
  </script>
</head>
<body>
  <div id="theme-decor"></div>
  <div class="container">
    <h1>ğŸ¥— Potluck Party!</h1>
    <p id="event-title">Loading event...</p>
    <p id="missing-dishes" style="color: #ff6d00; font-weight: bold; text-align: center;"></p>
    <p style="text-align: center; margin: 10px 0;">
      <a href="create.html" style="color: #9c27b0; font-weight: bold; text-decoration: none;">
        â• Create New Themed Event
      </a>
    </p>
    <button id="dark-toggle" onclick="document.body.classList.toggle('dark')">ğŸŒ™</button>
    <div class="form">
      <input type="text" id="name" placeholder="Your name" required />
      <input type="text" id="dish" placeholder="What are you bringing?" required />
      <select id="category">
        <option>Appetizers</option>
        <option>Main</option>
        <option>Dessert</option>
        <option>Drinks</option>
      </select>
      <select id="diet">
        <option value="">Dietary</option>
        <option>Vegan</option>
        <option>Vegetarian</option>
        <option>Gluten-Free</option>
      </select>
      <button onclick="addItem()">Add to Potluck!</button>
      <button onclick="voiceAdd()">ğŸ¤ Voice Add</button>
    </div>
    <div class="ai-section">
      <input id="mood" placeholder="Mood (e.g., vegan)" />
      <button onclick="aiSuggest()">ğŸ¤– AI Suggest</button>
      <p id="ai-idea"></p>
    </div>
    <div id="potluck-list"></div>
    <div id="bingo-card"></div>
    <div id="map" style="height:300px;"></div>
    <div class="photo-section">
      <h3>ğŸ“¸ Photos</h3>
      <input type="file" id="photo" accept="image/*">
      <button onclick="uploadPhoto()">Upload</button>
      <div id="photo-gallery"></div>
    </div>
    <button onclick="generateQR()">ğŸ“± QR Code</button>
    <div id="qr"></div>
    <button onclick="startBingo()">ğŸ° Bingo</button>
    <button onclick="shareLocation()">ğŸ“ Share Location</button>
    <button onclick="exportPotluck()">ğŸ“„ Print List</button>
  </div>
  <div id="ar-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:9999; backdrop-filter:blur(10px);">
    <button onclick="closeAR()" style="position:absolute; top:20px; right:20px; color:white; background:rgba(255,255,255,0.2); border:2px solid white; border-radius:50%; width:50px; height:50px; font-size:24px; cursor:pointer; z-index:10000; transition:all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">âœ•</button>
    <div style="position:absolute; top:20px; left:20px; color:white; font-size:18px; background:rgba(0,0,0,0.5); padding:10px 20px; border-radius:10px;">
      ğŸ¨ AR Preview - Rotate & Zoom
    </div>
    <model-viewer 
      id="ar-viewer" 
      src="" 
      ar 
      ar-modes="webxr scene-viewer quick-look" 
      camera-controls 
      auto-rotate 
      shadow-intensity="1"
      style="width:100%; height:100%;">
    </model-viewer>
  </div>
  <script src="firebase-config.js"></script>
  <script src="app.js"></script>
</body>
</html>