<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Potluck Party - Simple & Fun</title>
    <meta name="description" content="Simple potluck planning - like Google Sheets but 10x more fun!">
    
    <!-- Tailwind CDN only -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.5s ease-out',
                        'float': 'float 3s ease-in-out infinite'
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        /* Theme backgrounds */
        .bg-theme {
            transition: all 0.8s ease-in-out;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .bg-theme::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }
        
        .bg-default {
            background: linear-gradient(135deg, #fbbf24 0%, #ec4899 100%);
        }
        
        .bg-birthday {
            background-image: url('https://images.unsplash.com/photo-1503424886303-4f7c2d8a6e9e?q=80&w=1200');
        }
        
        .bg-festival {
            background-image: url('https://images.unsplash.com/photo-1604328698692-bf2d8e1d5b59?q=80&w=1200');
        }
        
        .bg-picnic {
            background-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=1200');
        }
        .card-hover { transition: all 0.2s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes float {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .dish-pill { 
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .dish-meat { background: #fecaca; color: #991b1b; }
        .dish-vegan { background: #bbf7d0; color: #166534; }
        .dish-dessert { background: #fef3c7; color: #92400e; }
        .dish-drink { background: #ddd6fe; color: #5b21b6; }
        .dish-other { background: #e5e7eb; color: #374151; }
    </style>
</head>
<body class="bg-theme bg-default min-h-screen font-sans">
    
    <!-- SIMPLE: One screen, no tabs -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        
        <!-- Theme Selector -->
        <div class="flex justify-center mb-6">
            <div class="bg-white/80 backdrop-blur-md rounded-2xl shadow-lg px-6 py-4 flex items-center gap-4">
                <label class="text-gray-700 font-semibold">üé® Theme:</label>
                <select id="themeSelector" onchange="applyTheme(this.value)"
                    class="px-4 py-2 rounded-lg border border-gray-300 bg-white/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-amber-400 transition-all cursor-pointer">
                    <option value="default">üåÖ Default</option>
                    <option value="birthday">üéÇ Birthday</option>
                    <option value="festival">üéâ Festival</option>
                    <option value="picnic">üß∫ Picnic</option>
                </select>
            </div>
        </div>
        
        <!-- Party Name (Editable) -->
        <div class="text-center mb-8">
            <h1 id="partyTitle" contenteditable="true" 
                class="text-4xl md:text-5xl font-black text-white mb-2 outline-none hover:bg-white/20 rounded-lg px-4 py-2 transition-colors cursor-text drop-shadow-lg">
                Thanksgiving 2025 ‚ú®
            </h1>
            <p class="text-white/90 text-lg drop-shadow">Simple potluck planning - like Google Sheets but 10x more fun!</p>
        </div>
        
        <!-- Add Guest Button -->
        <div class="flex justify-center mb-6">
            <button onclick="showAddGuest()" 
                class="bg-white/90 backdrop-blur-md text-gray-800 px-6 py-3 rounded-full font-bold shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2">
                <span class="text-xl">‚ûï</span> Add Guest
            </button>
        </div>
        
        <!-- Guest Count -->
        <div class="text-center mb-6">
            <div class="inline-block bg-white/80 backdrop-blur px-6 py-3 rounded-full shadow-md">
                <span class="text-2xl font-bold text-gray-800" id="guestCount">0</span>
                <span class="text-gray-600 ml-2">GUESTS COMING</span>
            </div>
        </div>
        
        <!-- Guests Table -->
        <div class="bg-white/80 backdrop-blur-md rounded-2xl shadow-xl overflow-hidden mb-8">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th onclick="sortBy('emoji')" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-100">
                                Avatar ‚ÜïÔ∏è
                            </th>
                            <th onclick="sortBy('name')" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-100">
                                Name ‚ÜïÔ∏è
                            </th>
                            <th onclick="sortBy('dish')" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 cursor-pointer hover:bg-gray-100">
                                Dish ‚ÜïÔ∏è
                            </th>
                            <th class="px-6 py-4 text-right text-sm font-semibold text-gray-700">
                                Action
                            </th>
                        </tr>
                    </thead>
                    <tbody id="guestsList" class="divide-y divide-gray-100">
                        <!-- Guests added here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 text-gray-400">
                <div class="text-6xl mb-4">üçΩÔ∏è</div>
                <p class="text-xl font-medium">No guests yet</p>
                <p class="text-sm mt-2">Click "Add Guest" to get started!</p>
            </div>
        </div>
        
        <!-- Footer Actions -->
        <div class="flex justify-center gap-4 flex-wrap">
            <button onclick="copyLink()" 
                class="bg-white text-gray-700 px-4 py-2 rounded-lg shadow hover:shadow-md transition-all flex items-center gap-2">
                <span>üìã</span> Copy Link
            </button>
            <button onclick="showQR()" 
                class="bg-white text-gray-700 px-4 py-2 rounded-lg shadow hover:shadow-md transition-all flex items-center gap-2">
                <span>üì±</span> QR
            </button>
            <button onclick="exportCSV()" 
                class="bg-white/90 backdrop-blur-md text-gray-700 px-4 py-2 rounded-lg shadow hover:shadow-md hover:scale-105 transition-all flex items-center gap-2">
                <span>üìÑ</span> Export CSV
            </button>
            <button onclick="clearAll()" 
                class="bg-red-500/90 backdrop-blur-md text-white px-4 py-2 rounded-lg shadow hover:shadow-md hover:scale-105 transition-all flex items-center gap-2">
                <span>üóëÔ∏è</span> Clear All
            </button>
        </div>
        
        <!-- Footer Note -->
        <div class="text-center mt-8 text-white/70 text-sm drop-shadow">
            Made with ‚ù§Ô∏è for happy gatherings
        </div>
    </main>
    
    <!-- Add Guest Modal -->
    <div id="addGuestModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl animate-bounce-in">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Add Guest</h3>
            <form onsubmit="addGuest(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
                    <input type="text" id="guestName" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400"
                        placeholder="Enter name...">
                    <p id="nameError" class="text-red-500 text-xs mt-1 hidden">Name is required</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Dish *</label>
                    <select id="guestDish" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400">
                        <option value="">Select a dish...</option>
                        <option value="Pizza">üçï Pizza</option>
                        <option value="Pie">ü•ß Pie</option>
                        <option value="Beer">üç∫ Beer</option>
                        <option value="Salad">ü•ó Salad</option>
                        <option value="custom">üçΩÔ∏è Custom dish...</option>
                    </select>
                    <input type="text" id="customDish" 
                        class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 hidden"
                        placeholder="Enter custom dish...">
                    <p id="dishError" class="text-red-500 text-xs mt-1 hidden">Dish is required</p>
                </div>
                <div class="flex gap-3">
                    <button type="submit" 
                        class="flex-1 bg-amber-500 text-white py-3 rounded-lg font-bold hover:bg-amber-600 transition-colors shadow-md hover:shadow-lg">
                        Add Guest
                    </button>
                    <button type="button" onclick="hideAddGuest()" 
                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- QR Modal -->
    <div id="qrModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Share Party</h3>
            <div id="qrcode" class="flex justify-center mb-4"></div>
            <button onclick="hideQR()" 
                class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition-colors">
                Close
            </button>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Confetti Canvas -->
    <canvas id="confetti" class="fixed inset-0 pointer-events-none z-50"></canvas>
    
    <!-- SIMPLE: Google Sheets speed + party vibes -->
    <script>
        // Data: URL hash Base64 {guests: [], title: "Potluck Party", theme: "default"}
        let data = { guests: [], title: "Thanksgiving 2025 ‚ú®", theme: "default" };
        let saveTimer = null;
        let sortOrder = { field: null, ascending: true };
        
        // Random emoji picker
        const emojis = ['üéà', 'üçï', 'ü•ó', 'ü•§', 'üéâ', 'üë©‚Äçüç≥', 'üßë‚Äçüç≥', 'üòÑ', 'ü•≥', 'üéä', 'üçª', 'ü•Ç', 'üç∞', 'üéÇ', 'üçî', 'üåÆ', 'üçú', 'üç™', 'ü•ß', 'üç∫'];
        
        // Theme management
        function applyTheme(theme) {
            const body = document.body;
            body.classList.remove('bg-default', 'bg-birthday', 'bg-festival', 'bg-picnic');
            body.classList.add(`bg-${theme}`);
            data.theme = theme;
            save();
            localStorage.setItem('potluckTheme', theme);
        }
        
        // Load from URL hash (50ms load) + localStorage
        function loadData() {
            const hash = location.hash.slice(1);
            if (hash.startsWith('data=')) {
                try {
                    data = JSON.parse(atob(hash.slice(5)));
                } catch (e) {
                    console.error('Invalid data in hash');
                }
            } else {
                // Try loading from localStorage as backup
                const stored = localStorage.getItem('potluckData');
                if (stored) {
                    try {
                        data = JSON.parse(stored);
                    } catch (e) {
                        console.error('Invalid localStorage data');
                    }
                }
            }
            
            // Apply saved theme
            if (data.theme) {
                applyTheme(data.theme);
            } else {
                const savedTheme = localStorage.getItem('potluckTheme') || 'default';
                applyTheme(savedTheme);
            }
            
            render();
        }
        
        // Save: Every keystroke (debounce 100ms) + localStorage
        function save() {
            if (saveTimer) return;
            saveTimer = setTimeout(() => {
                const encoded = btoa(JSON.stringify(data));
                location.hash = 'data=' + encoded;
                // Also save to localStorage as backup
                localStorage.setItem('potluckData', JSON.stringify(data));
                saveTimer = null;
            }, 100);
        }
        
        // Show add guest modal
        function showAddGuest() {
            document.getElementById('addGuestModal').classList.remove('hidden');
            document.getElementById('guestName').focus();
            // Clear previous errors
            document.getElementById('nameError').classList.add('hidden');
            document.getElementById('dishError').classList.add('hidden');
        }
        
        function hideAddGuest() {
            document.getElementById('addGuestModal').classList.add('hidden');
            document.getElementById('guestName').value = '';
            document.getElementById('guestDish').value = '';
            document.getElementById('customDish').value = '';
            document.getElementById('customDish').classList.add('hidden');
        }
        
        // Add guest function with validation
        function addGuest(event) {
            event.preventDefault();
            
            const nameInput = document.getElementById('guestName');
            const dishSelect = document.getElementById('guestDish');
            const customDishInput = document.getElementById('customDish');
            
            const name = nameInput.value.trim();
            const dishValue = dishSelect.value;
            const customDish = customDishInput.value.trim();
            const dish = dishValue === 'custom' ? customDish : dishValue;
            
            // Validation: Name is required
            if (!name) {
                document.getElementById('nameError').textContent = 'Name is required';
                document.getElementById('nameError').classList.remove('hidden');
                nameInput.focus();
                return;
            }
            
            // Validation: Check for duplicate names
            const duplicate = data.guests.find(g => g.name.toLowerCase() === name.toLowerCase());
            if (duplicate) {
                document.getElementById('nameError').textContent = 'This name already exists!';
                document.getElementById('nameError').classList.remove('hidden');
                nameInput.focus();
                showToast('‚ö†Ô∏è Duplicate name not allowed', 'warning');
                return;
            }
            
            // Validation: Dish is required
            if (!dish) {
                document.getElementById('dishError').textContent = 'Dish is required';
                document.getElementById('dishError').classList.remove('hidden');
                if (dishValue === 'custom') {
                    customDishInput.focus();
                } else {
                    dishSelect.focus();
                }
                return;
            }
            
            const guest = {
                name,
                dish,
                emoji: emojis[Math.floor(Math.random() * emojis.length)],
                id: Date.now()
            };
            
            data.guests.push(guest);
            save();
            render();
            hideAddGuest();
            
            // Confetti burst + toast
            confetti();
            showToast(`Guest added! üéâ ${name} is bringing ${dish}`, 'success');
        }
        
        // Remove guest
        function removeGuest(id) {
            const guest = data.guests.find(g => g.id === id);
            data.guests = data.guests.filter(g => g.id !== id);
            save();
            render();
            showToast(`${guest.name} removed`, 'info');
        }
        
        // Clear all guests with confirmation
        function clearAll() {
            if (data.guests.length === 0) {
                showToast('No guests to clear', 'info');
                return;
            }
            
            if (confirm('Are you sure you want to remove all guests? This cannot be undone.')) {
                data.guests = [];
                save();
                render();
                showToast('All guests cleared üóëÔ∏è', 'warning');
            }
        }
        
        // Sort function
        function sortBy(field) {
            if (sortOrder.field === field) {
                sortOrder.ascending = !sortOrder.ascending;
            } else {
                sortOrder.field = field;
                sortOrder.ascending = true;
            }
            
            data.guests.sort((a, b) => {
                const aVal = a[field].toLowerCase();
                const bVal = b[field].toLowerCase();
                const result = aVal.localeCompare(bVal);
                return sortOrder.ascending ? result : -result;
            });
            
            render();
        }
        
        // Get dish category for color coding
        function getDishCategory(dish) {
            const lower = dish.toLowerCase();
            if (lower.includes('meat') || lower.includes('chicken') || lower.includes('beef') || lower.includes('pork')) return 'meat';
            if (lower.includes('salad') || lower.includes('vegetable') || lower.includes('vegan')) return 'vegan';
            if (lower.includes('pie') || lower.includes('cake') || lower.includes('cookie') || lower.includes('dessert')) return 'dessert';
            if (lower.includes('beer') || lower.includes('wine') || lower.includes('drink') || lower.includes('juice')) return 'drink';
            return 'other';
        }
        
        // Render function
        function render() {
            // Update title
            document.getElementById('partyTitle').textContent = data.title;
            document.getElementById('guestCount').textContent = data.guests.length;
            
            // Update page title
            const eventId = location.hash.slice(6, 14) || 'party';
            document.getElementById('pageTitle').textContent = `Potluck #${eventId} | ${data.guests.length} bringing dishes!`;
            
            // Render guests
            const guestsList = document.getElementById('guestsList');
            const emptyState = document.getElementById('emptyState');
            
            if (data.guests.length === 0) {
                guestsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            guestsList.innerHTML = data.guests.map((guest, index) => {
                const category = getDishCategory(guest.dish);
                return `
                    <tr class="hover:bg-gray-50 card-hover animate-slide-in" style="animation-delay: ${index * 0.05}s">
                        <td class="px-6 py-4">
                            <span class="text-2xl">${guest.emoji}</span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">${guest.name}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="dish-pill dish-${category}">${guest.dish}</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="removeGuest(${guest.id})" 
                                class="text-red-500 hover:text-red-700 font-medium text-sm">
                                Remove
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Copy link with success message
        function copyLink() {
            navigator.clipboard.writeText(location.href).then(() => {
                showToast('Link copied to clipboard! üìã', 'success');
            }).catch(() => {
                showToast('Failed to copy link', 'error');
            });
        }
        
        // Show QR
        function showQR() {
            document.getElementById('qrModal').classList.remove('hidden');
            
            // Simple QR code (using QRCode.js CDN would be better, but keeping it simple)
            const qrDiv = document.getElementById('qrcode');
            qrDiv.innerHTML = `
                <div class="bg-gray-100 p-4 rounded-lg text-center">
                    <div class="text-6xl mb-2">üì±</div>
                    <p class="text-sm text-gray-600">Scan to join party!</p>
                    <p class="text-xs text-gray-500 mt-2 break-all">${location.href}</p>
                </div>
            `;
        }
        
        function hideQR() {
            document.getElementById('qrModal').classList.add('hidden');
        }
        
        // Export CSV with success message
        function exportCSV() {
            if (data.guests.length === 0) {
                showToast('No guests to export', 'info');
                return;
            }
            
            const csv = [
                ['Name', 'Dish', 'Avatar'],
                ...data.guests.map(g => [g.name, g.dish, g.emoji])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `potluck-guests-${Date.now()}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('CSV exported successfully! üìÑ', 'success');
        }
        
        // Improved toast notification system
        function showToast(msg, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            toast.className = `${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg animate-slide-in`;
            toast.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>${msg}</span>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                toast.style.transition = 'all 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Confetti animation
        function confetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = Array.from({ length: 50 }, () => ({
                x: Math.random() * canvas.width,
                y: -10,
                vx: (Math.random() - 0.5) * 4,
                vy: Math.random() * 3 + 2,
                color: ['#10b981', '#f59e0b', '#ef4444', '#8b5cf6'][Math.floor(Math.random() * 4)],
                size: Math.random() * 6 + 4
            }));
            
            const animate = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1; // gravity
                    
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    
                    if (p.y > canvas.height) {
                        particles.splice(i, 1);
                    }
                });
                
                if (particles.length > 0) {
                    requestAnimationFrame(animate);
                }
            };
            
            animate();
        }
        
        // Handle custom dish input
        document.getElementById('guestDish')?.addEventListener('change', function() {
            const customInput = document.getElementById('customDish');
            if (this.value === 'custom') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.value = '';
            }
        });
        
        // Handle title editing
        document.getElementById('partyTitle')?.addEventListener('input', function() {
            data.title = this.textContent;
            save();
        });
        
        // Handle hash changes (real-time sync)
        window.addEventListener('hashchange', loadData);
        
        // Initialize
        window.addEventListener('DOMContentLoaded', loadData);
        
        // Live sync - check for changes every second
        setInterval(() => {
            const currentHash = location.hash;
            if (currentHash && currentHash !== 'data=' + btoa(JSON.stringify(data))) {
                loadData();
            }
        }, 1000);
    </script>
</body>
</html>
